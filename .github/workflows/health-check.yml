name: Health Check Cron

on:
  schedule:
    - cron: '*/30 * * * *'  # ë§¤ 30ë¶„ë§ˆë‹¤
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  health-check:
    runs-on: ubuntu-latest
    steps:
      - name: Check cron system health
        run: |
          echo "Running health check at $(date -u +"%Y-%m-%d %H:%M:%S") UTC"

          # Test posting endpoint (quick test)
          if ! curl -X POST "https://make-page.com/test-posting" \
            -H "Content-Type: application/json" \
            -d '{"subdomain":"00001"}' \
            --max-time 60 \
            --fail-with-body; then

            # Send Telegram alert
            curl -X POST "https://api.telegram.org/bot8328468112:AAHcfkNgMXPR4hbc4b5g0G3K_oFnQurryqs/sendMessage" \
              -H "Content-Type: application/json" \
              -d "{\"chat_id\":\"6857038085\",\"text\":\"ğŸ”´ í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨\n\nì‹œê°„: $(date -u +"%Y-%m-%d %H:%M:%S") UTC\në¬¸ì œ: í¬ë¡  ì‹œìŠ¤í…œ ì‘ë‹µ ì—†ìŒ\nì¡°ì¹˜: ì‹œìŠ¤í…œ ì ê²€ í•„ìš”\"}" \
              --max-time 10

            exit 1
          fi

          echo "âœ… Health check passed"
