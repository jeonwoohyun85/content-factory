name = "make-page-subdomain"
main = "make-page-subdomain.js"
compatibility_date = "2024-01-01"
account_id = "73506724e3c7dd97bc939983761a90cf"

# Production (default)
routes = [
  { pattern = "make-page.com/*", zone_id = "6336f0fab5cb7b480e1f7b44698aef60" },
  { pattern = "*.make-page.com/*", zone_id = "6336f0fab5cb7b480e1f7b44698aef60" }
]

# KV 바인딩 (HTML 캐싱, 크론 중복 방지)
[[kv_namespaces]]
binding = "POSTING_KV"
id = "53f9ec640f8c4d2f889042b127c5c327"

# Cloudflare Cron + Queue 시스템 (2026-01-20)
# Workers Paid 플랜 - Queue 사용 가능
[triggers]
crons = ["0 0 * * *"]  # 매일 한국시간 09:00 (UTC 00:00)

# Queue 바인딩 (포스팅 실패 시 재시도)
[[queues.producers]]
queue = "posting-queue"
binding = "POSTING_QUEUE"

[[queues.consumers]]
queue = "posting-queue"
max_batch_size = 5
max_batch_timeout = 60  # Cloudflare 제한: 최대 60초 (Gemini 타임아웃도 50초로 맞춤)
max_retries = 3  # 1회 → 3회 (일시적 오류 복구력 향상)

[vars]
SHEETS_ID = "1KrzLFi8Wt9GTGT97gcMoXnbZ3OJ04NsP4lncJyIdyhU"
DRIVE_FOLDER_ID = "1JiVmIkliR9YrPIUPOn61G8Oh7h9HTMEt"
